<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AJ Crackers - Customer View</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    h1 {
      color: #d9534f;
    }
    input[type="text"], input[type="tel"] {
      padding: 8px;
      margin-bottom: 10px;
      width: 250px;
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    input[type="number"] {
      width: 60px;
    }
    .total-section {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    .button-group {
      margin-top: 20px;
    }
    .button-group button {
      padding: 12px 20px;
      font-size: 16px;
      margin-right: 10px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    .whatsapp-button {
      background-color: #25D366;
      color: white;
    }
    .print-button {
      background-color: #007bff;
      color: white;
    }
    .footer-note {
      margin-top: 40px;
      color: #888;
      font-size: 14px;
    }
    .offer-days-left {
      font-size: 16px;
      margin-top: 10px;
      color: #555;
    }
  </style>
</head>
<body>

<h1>üéá AJ Crackers - Firework Price List</h1>
<p><strong>Offer:</strong> Flat 70% Discount Applied</p>
<p class="offer-days-left" id="daysLeft"></p>

<label for="customerName">Your Name:</label>
<input type="text" id="customerName" placeholder="Enter your name" />

<label for="customerPhone">Your Phone (optional):</label>
<input type="tel" id="customerPhone" placeholder="Enter your phone number" />

<table id="productTable">
  <thead>
    <tr>
      <th>Firework Name</th>
      <th>Original Price (‚Çπ)</th>
      <th>Quantity</th>
      <th>Total (‚Çπ)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="total-section">
  <p>Discount: <strong>70%</strong></p>
  <p>Total Original Price: ‚Çπ<span id="originalTotal">0.00</span></p>
  <p>Total Discount Amount: ‚Çπ<span id="discountAmount">0.00</span></p>
  <p><strong>Grand Total (After Discount): ‚Çπ<span id="grandTotal">0.00</span></strong></p>
</div>


<div class="button-group">
  <button class="whatsapp-button" onclick="sendOrderToWhatsApp()">Send Order via WhatsApp</button>
  <button class="print-button" onclick="window.print()">Print Order</button>
</div>

<p class="footer-note">* Offer is fixed at 70% and prices shown are after discount. Prices inclusive of taxes.</p>

<script>
  const offerPercent = 70;
  const offerMultiplier = (100 - offerPercent) / 100;

  // Update this date to your actual offer end date
  const offerEndDate = new Date('2025-10-25'); // Example: October 25, 2025

  function showDaysLeft() {
    const today = new Date();
    const timeDiff = offerEndDate - today;
    const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

    const msg = daysLeft > 0
      ? `üî• Hurry! Only ${daysLeft} day${daysLeft !== 1 ? 's' : ''} left for this offer!`
      : '‚ö†Ô∏è The offer has ended.';
    
    document.getElementById('daysLeft').textContent = msg;
  }

  async function loadProducts() {
    try {
      const res = await fetch("products.json");
      const products = await res.json();
      renderProductTable(products);
    } catch (e) {
      document.body.innerHTML = "<p>Error loading products. Please try again later.</p>";
    }
  }

  function renderProductTable(products) {
    const tbody = document.querySelector("#productTable tbody");
    products.forEach(item => {
      const offerPrice = (item.price * offerMultiplier).toFixed(2);
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.name}</td>
        <td>‚Çπ${item.price}</td>
        <td><input type="number" min="0" value="0" onchange="calculateTotals()" data-price="${offerPrice}" data-name="${item.name}" /></td>
        <td class="item-total">‚Çπ0.00</td>
      `;
      tbody.appendChild(row);
    });
  }

 function calculateTotals() {
  let originalTotal = 0;
  let discountTotal = 0;
  let finalTotal = 0;

  const rows = document.querySelectorAll("#productTable tbody tr");

  rows.forEach(row => {
    const qtyInput = row.querySelector("input[type='number']");
    const qty = parseInt(qtyInput.value) || 0;
    const originalPrice = parseFloat(row.children[1].textContent.replace("‚Çπ", ""));
    const discountedPrice = parseFloat(qtyInput.dataset.price);
    const total = qty * discountedPrice;

    const originalSubtotal = qty * originalPrice;
    const discountAmount = originalSubtotal - total;

    row.querySelector(".item-total").textContent = `‚Çπ${total.toFixed(2)}`;

    originalTotal += originalSubtotal;
    discountTotal += discountAmount;
    finalTotal += total;
  });

  document.getElementById("originalTotal").textContent = originalTotal.toFixed(2);
  document.getElementById("discountAmount").textContent = discountTotal.toFixed(2);
  document.getElementById("grandTotal").textContent = finalTotal.toFixed(2);
}


  function sendOrderToWhatsApp() {
    const name = document.getElementById("customerName").value.trim();
    const phone = document.getElementById("customerPhone").value.trim();

    if (!name) {
      alert("Please enter your name before sending the order.");
      return;
    }

    const rows = document.querySelectorAll("#productTable tbody tr");
    let message = `Hi, I'm ${name}, and I'd like to place an order:\n\n`;
    let total = 0;

    rows.forEach(row => {
      const input = row.querySelector("input[type='number']");
      const qty = parseInt(input.value);
      const itemName = input.dataset.name;
      const price = parseFloat(input.dataset.price);

      if (qty && qty > 0) {
        const itemTotal = (qty * price).toFixed(2);
        message += `- ${itemName} x ${qty} = ‚Çπ${itemTotal}\n`;
        total += qty * price;
      }
    });

    if (total === 0) {
      alert("Please select at least one product.");
      return;
    }

    message += `\nTotal: ‚Çπ${total.toFixed(2)}`;
    if (phone) message += `\nPhone: ${phone}`;
    message += `\n\nThank you!`;

    const whatsappURL = `https://wa.me/918296772217?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, '_blank');
  }

  showDaysLeft();
  loadProducts();
</script>

</body>
</html>
