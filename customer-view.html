<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AJ Crackers - Customer View</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    h1 {
      color: #d9534f;
    }
    input[type="text"], input[type="tel"] {
      padding: 8px;
      margin-bottom: 10px;
      width: 250px;
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    input[type="number"] {
      width: 60px;
    }
    .total-section {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    .button-group {
      margin-top: 20px;
    }
    .button-group button {
      padding: 12px 20px;
      font-size: 16px;
      margin-right: 10px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    .whatsapp-button {
      background-color: #25D366;
      color: white;
    }
    .print-button {
      background-color: #007bff;
      color: white;
    }
    .footer-note {
      margin-top: 40px;
      color: #888;
      font-size: 14px;
    }
  </style>
</head>
<body>

<h1>ðŸŽ‡ AJ Crackers - Firework Price List</h1>
<p><strong>Offer:</strong> Flat 70% Discount Applied</p>

<label for="customerName">Your Name:</label>
<input type="text" id="customerName" placeholder="Enter your name" />

<label for="customerPhone">Your Phone (optional):</label>
<input type="tel" id="customerPhone" placeholder="Enter your phone number" />

<table id="productTable">
  <thead>
    <tr>
      <th>Firework Name</th>
      <th>Original Price (â‚¹)</th>
      <th>Offer Price (30%)</th>
      <th>Quantity</th>
      <th>Total (â‚¹)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="total-section">Grand Total: â‚¹<span id="grandTotal">0.00</span></div>

<div class="button-group">
  <button class="whatsapp-button" onclick="sendOrderToWhatsApp()">Send Order via WhatsApp</button>
  <button class="print-button" onclick="window.print()">Print Order</button>
</div>

<p class="footer-note">* Offer is fixed at 70% and prices shown are after discount. Prices inclusive of taxes.</p>

<script>
  const queryParams = new URLSearchParams(window.location.search);
  const rawData = queryParams.get("data");

  const offerPercent = 70;
  const offerMultiplier = (100 - offerPercent) / 100;

  if (rawData) {
    try {
      const products = JSON.parse(decodeURIComponent(rawData));
      const tbody = document.querySelector("#productTable tbody");

      products.forEach(item => {
        const offerPrice = (item.price * offerMultiplier).toFixed(2);
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.name}</td>
          <td>â‚¹${item.price}</td>
          <td>â‚¹${offerPrice}</td>
          <td><input type="number" min="0" value="0" onchange="calculateTotals()" data-price="${offerPrice}" data-name="${item.name}" /></td>
          <td class="item-total">â‚¹0.00</td>
        `;
        tbody.appendChild(row);
      });

    } catch (e) {
      document.body.innerHTML = "<p>Error loading data. Please try again.</p>";
    }
  } else {
    document.body.innerHTML = "<p>No data found. Please use the correct link.</p>";
  }

  function calculateTotals() {
    let grandTotal = 0;
    const rows = document.querySelectorAll("#productTable tbody tr");

    rows.forEach(row => {
      const qtyInput = row.querySelector("input[type='number']");
      const qty = parseInt(qtyInput.value) || 0;
      const price = parseFloat(qtyInput.dataset.price);
      const total = qty * price;

      row.querySelector(".item-total").textContent = `â‚¹${total.toFixed(2)}`;
      grandTotal += total;
    });

    document.getElementById("grandTotal").textContent = grandTotal.toFixed(2);
  }

  function sendOrderToWhatsApp() {
    const name = document.getElementById("customerName").value.trim();
    const phone = document.getElementById("customerPhone").value.trim();

    if (!name) {
      alert("Please enter your name before sending the order.");
      return;
    }

    const rows = document.querySelectorAll("#productTable tbody tr");
    let message = `Hi, I'm ${name}, and I'd like to place an order:\n\n`;
    let total = 0;

    rows.forEach(row => {
      const input = row.querySelector("input[type='number']");
      const qty = parseInt(input.value);
      const itemName = input.dataset.name;
      const price = parseFloat(input.dataset.price);

      if (qty && qty > 0) {
        const itemTotal = (qty * price).toFixed(2);
        message += `- ${itemName} x ${qty} = â‚¹${itemTotal}\n`;
        total += qty * price;
      }
    });

    if (total === 0) {
      alert("Please select at least one product.");
      return;
    }

    message += `\nTotal: â‚¹${total.toFixed(2)}`;
    if (phone) message += `\nCustomer Phone: ${phone}`;
    message += `\n\nThank you!`;

    const whatsappURL = `https://wa.me/918296772217?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, '_blank');
  }
</script>

</body>
</html>
